<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - 博客后台管理系统</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome 图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Layui CSS -->
    <link href="https://cdn.jsdelivr.net/npm/layui@2.8.18/dist/css/layui.css" rel="stylesheet">

    <!--后端主体样式-->
    <link href="~/css/main.css" rel="stylesheet" />
        <!-- 自定义样式 -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

    <!-- JavaScript 库 -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/layui/layui.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
  
</head>
<body>
    <!-- 侧边栏 -->
    <div id="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-blog me-2"></i> <span>博客后台</span></h3>
        </div>
        <div class="sidebar-menu">
            <ul>
                <li><a href="/" class="active"><i class="fas fa-tachometer-alt"></i> <span>仪表盘</span></a></li>

                <li class="has-submenu">
                    <a href="javascript:void(0);" class="submenu-toggle">
                        <i class="fas fa-users"></i> <span>用户管理</span>
                        <i class="fas fa-chevron-down menu-arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="/Users">用户列表</a></li>
                        <li><a href="/Users/Add">添加用户</a></li>
                        <li><a href="/Users/Roles">角色管理</a></li>
                        <li><a href="/Permissions">权限配置</a></li>
                    </ul>
                </li>

                <li class="has-submenu">
                    <a href="javascript:void(0);" class="submenu-toggle">
                        <i class="fas fa-file-alt"></i> <span>内容管理</span>
                        <i class="fas fa-chevron-down menu-arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="/Article">文章管理</a></li>
                        <li><a href="/Article/Write">写文章</a></li>
                        <li><a href="/Article/Category">分类管理</a></li>
                        <li><a href="/Article/Tags">标签管理</a></li>
                        <li><a href="/Comments">评论管理</a></li>
                    </ul>
                </li>

                <li class="has-submenu">
                    <a href="javascript:void(0);" class="submenu-toggle">
                        <i class="fas fa-cog"></i> <span>系统设置</span>
                        <i class="fas fa-chevron-down menu-arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="/SysManager/General">基本设置</a></li>
                        <li><a href="/SysManager/SEO">SEO设置</a></li>
                        <li><a href="/SysManager/Email">邮件设置</a></li>
                        <li><a href="/SysManager/Storage">存储设置</a></li>
                    </ul>
                </li>

                <li class="has-submenu">
                    <a href="javascript:void(0);" class="submenu-toggle">
                        <i class="fas fa-chart-bar"></i> <span>数据统计</span>
                        <i class="fas fa-chevron-down menu-arrow"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="/Statistics/Overview">数据概览</a></li>
                        <li><a href="/Statistics/Articles">文章统计</a></li>
                        <li><a href="/Statistics/Users">用户统计</a></li>
                        <li><a href="/Statistics/Visits">访问统计</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <!-- 顶部导航栏 -->
    <header id="header">
        <div class="header-left">
            <button class="toggle-sidebar" id="toggleSidebar">
                <i class="fas fa-bars"></i>
            </button>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i> 首页</a></li>
                    <li class="breadcrumb-item active">@ViewData["Title"]</li>
                </ol>
            </nav>
        </div>
        <div class="header-right">
            <div class="user-menu">
                <div class="user-avatar">A</div>
                <div class="dropdown">
                    <a class="dropdown-toggle" href="#" role="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        管理员 <i class="fas fa-chevron-down ms-1"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li><a class="dropdown-item" href="#"><i class="fas fa-user me-2"></i> 个人资料</a></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-2"></i> 账户设置</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/Account/Logout"><i class="fas fa-sign-out-alt me-2"></i> 退出登录</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <!-- 主内容区域 -->
    <main id="main-content">
        @RenderBody()
    </main>

    <!-- 页脚 -->
    <footer class="border-top footer text-muted">
        <div class="container text-center">
            &copy; 2025 - 博客后台管理系统 - <a asp-area="" asp-page="/Privacy">隐私政策</a>
        </div>
    </footer>

    <!-- 布局页面脚本 -->
    <script>
        // 侧边栏折叠/展开功能
        document.getElementById('toggleSidebar').addEventListener('click', function() {
            document.body.classList.toggle('sidebar-collapsed');

            // 隐藏或显示所有箭头图标
            const menuArrows = document.querySelectorAll('.menu-arrow');
            menuArrows.forEach(arrow => {
                arrow.style.display = document.body.classList.contains('sidebar-collapsed') ? 'none' : 'block';
            });

            // 保存用户偏好设置到本地存储
            if (document.body.classList.contains('sidebar-collapsed')) {
                localStorage.setItem('sidebarCollapsed', 'true');
            } else {
                localStorage.setItem('sidebarCollapsed', 'false');
            }
        });

        // 页面加载时检查用户偏好设置
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarCollapsed = localStorage.getItem('sidebarCollapsed');
            if (sidebarCollapsed === 'true') {
                document.body.classList.add('sidebar-collapsed');

                // 隐藏所有箭头图标
                const menuArrows = document.querySelectorAll('.menu-arrow');
                menuArrows.forEach(arrow => {
                    arrow.style.display = 'none';
                });
            }

            // 二级菜单展开/收起功能
            const submenuToggles = document.querySelectorAll('.submenu-toggle');

            submenuToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    const submenu = this.nextElementSibling;
                    const arrowIcon = this.querySelector('.menu-arrow');

                    // 切换子菜单的展开状态
                    submenu.classList.toggle('open');

                    // 切换箭头图标的方向
                    if (arrowIcon.classList.contains('fa-chevron-down')) {
                        arrowIcon.classList.remove('fa-chevron-down');
                        arrowIcon.classList.add('fa-chevron-up');
                    } else {
                        arrowIcon.classList.remove('fa-chevron-up');
                        arrowIcon.classList.add('fa-chevron-down');
                    }
                });
            });

            // 菜单项点击激活状态
            const menuItems = document.querySelectorAll('.sidebar-menu a');
            const currentPath = window.location.pathname;

            menuItems.forEach(item => {
                // 设置当前页面菜单项为激活状态
                if (item.getAttribute('href') === currentPath ||
                    (currentPath === '/' && item.getAttribute('href') === '/')) {
                    item.classList.add('active');

                    // 自动展开父级菜单
                    const parentMenu = item.closest('.submenu');
                    if (parentMenu) {
                        parentMenu.classList.add('open');
                        const toggle = parentMenu.previousElementSibling;
                        if (toggle) {
                            const arrowIcon = toggle.querySelector('.menu-arrow');
                            if (arrowIcon) {
                                arrowIcon.classList.remove('fa-chevron-down');
                                arrowIcon.classList.add('fa-chevron-up');
                            }
                        }
                    }
                }

                item.addEventListener('click', function(e) {
                    if (this.classList.contains('submenu-toggle')) {
                        e.preventDefault();
                        return;
                    }

                    menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        });

        // 响应式处理
        window.addEventListener('resize', function() {
            if (window.innerWidth <= 768) {
                document.body.classList.add('sidebar-collapsed');

                // 隐藏所有箭头图标
                const menuArrows = document.querySelectorAll('.menu-arrow');
                menuArrows.forEach(arrow => {
                    arrow.style.display = 'none';
                });
            }
        });
    </script>

    <!-- 修复Scripts部分的问题 -->
    @if (IsSectionDefined("Scripts"))
    {
        @await RenderSectionAsync("Scripts", required: false)
    }
</body>
</html>