@page
@model Blogs.AdminSite.Pages.Article.CategoryModel
@{
    ViewData["Title"] = "文章分类";
    Layout = "_Layout";
}
<div class="container-fluid py-4">
    <!-- 页面标题 -->
    <div class="page-header">
        <h1>文章分类管理</h1>
        <p class="text-muted">管理系统文章分类，用于文章组织和分类</p>
    </div>

    <!-- 搜索和操作区域 -->
    <div class="card">
        <div class="card-body">
            <div class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label">分类名称</label>
                    <input type="text" class="form-control" id="searchName" placeholder="请输入分类名称">
                </div>
                <div class="col-md-4">
                    <label class="form-label">状态</label>
                    <select class="form-select" id="searchStatus">
                        <option value="">全部</option>
                        <option value="1">启用</option>
                        <option value="0">禁用</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <button type="button" class="btn btn-primary w-100" id="searchBtn">
                        <i class="fas fa-search me-2"></i>搜索
                    </button>
                </div>
            </div>

            <div class="d-flex justify-content-between mt-3">
                <div>
                    <button class="btn btn-success" id="addCategoryBtn">
                        <i class="fas fa-plus me-2"></i> 添加分类
                    </button>
                    <button class="btn btn-danger" id="batchDeleteBtn">
                        <i class="fas fa-trash me-2"></i> 批量删除
                    </button>
                </div>
                <div>
                    <button class="btn btn-outline-secondary" id="refreshBtn">
                        <i class="fas fa-refresh me-2"></i> 刷新
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 分类表格 -->
    <div class="card mt-4">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover" id="categoryTable">
                    <thead>
                        <tr>
                            <th width="40">
                                <input type="checkbox" id="checkAll">
                            </th>
                            <th>ID</th>
                            <th>分类名称</th>
                            <th>图标</th>
                            <th>排序</th>
                            <th>文章数量</th>
                            <th>状态</th>
                            <th>创建时间</th>
                            <th width="150">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="checkbox" class="category-checkbox" value="1"></td>
                            <td>1</td>
                            <td>技术文章</td>
                            <td><i class="fas fa-code category-icon"></i></td>
                            <td>10</td>
                            <td>156</td>
                            <td><span class="badge bg-success">启用</span></td>
                            <td>2023-01-15</td>
                            <td>
                                <button class="btn btn-sm btn-primary edit-btn" data-id="1">编辑</button>
                                <button class="btn btn-sm btn-danger delete-btn" data-id="1">删除</button>
                            </td>
                        </tr>
                        <tr>
                            <td><input type="checkbox" class="category-checkbox" value="2"></td>
                            <td>2</td>
                            <td>生活随笔</td>
                            <td><i class="fas fa-pen category-icon"></i></td>
                            <td>20</td>
                            <td>89</td>
                            <td><span class="badge bg-success">启用</span></td>
                            <td>2023-02-20</td>
                            <td>
                                <button class="btn btn-sm btn-primary edit-btn" data-id="2">编辑</button>
                                <button class="btn btn-sm btn-danger delete-btn" data-id="2">删除</button>
                            </td>
                        </tr>
                        <tr>
                            <td><input type="checkbox" class="category-checkbox" value="3"></td>
                            <td>3</td>
                            <td>产品设计</td>
                            <td><i class="fas fa-palette category-icon"></i></td>
                            <td>30</td>
                            <td>42</td>
                            <td><span class="badge bg-secondary">禁用</span></td>
                            <td>2023-03-10</td>
                            <td>
                                <button class="btn btn-sm btn-primary edit-btn" data-id="3">编辑</button>
                                <button class="btn btn-sm btn-danger delete-btn" data-id="3">删除</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 分页 -->
            <div class="d-flex justify-content-between align-items-center mt-3">
                <div>显示第 1 到 3 条，共 15 条记录</div>
                <nav>
                    <ul class="pagination">
                        <li class="page-item disabled"><a class="page-link" href="#">上一页</a></li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">下一页</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- 添加/编辑分类弹框 -->
    <div class="modal fade" id="categoryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">添加分类</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="layui-form" id="categoryForm">
                        <input type="hidden" id="categoryId">
                        <div class="layui-form-item">
                            <label class="layui-form-label">分类名称</label>
                            <div class="layui-input-block">
                                <input type="text" id="categoryName" name="categoryName" lay-verify="required" placeholder="请输入分类名称" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">分类图标</label>
                            <div class="layui-input-block">
                                <select id="categoryIcon" name="categoryIcon" lay-verify="required">
                                    <option value="">请选择图标</option>
                                    <option value="fas fa-code">代码</option>
                                    <option value="fas fa-pen">笔</option>
                                    <option value="fas fa-palette">调色板</option>
                                    <option value="fas fa-book">书籍</option>
                                    <option value="fas fa-music">音乐</option>
                                    <option value="fas fa-camera">相机</option>
                                    <option value="fas fa-film">电影</option>
                                    <option value="fas fa-gamepad">游戏</option>
                                    <option value="fas fa-heart">爱心</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">排序</label>
                            <div class="layui-input-block">
                                <input type="number" id="sortOrder" name="sortOrder" lay-verify="required|number" placeholder="请输入排序值" class="layui-input sort-input" value="10">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">状态</label>
                            <div class="layui-input-block">
                                <input type="checkbox" id="status" name="status" lay-skin="switch" lay-text="启用|禁用" checked>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveCategoryBtn">保存</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<!-- Layui JS -->
<script src="https://cdn.jsdelivr.net/npm/layui@2.8.18/dist/layui.min.js"></script>

<script>
    layui.use(['form', 'layer'], function() {
        var form = layui.form;
        var layer = layui.layer;
        var $ = layui.$;

        // 设置表单验证
        form.verify({
            number: [/^\d+$/, '排序值必须为数字']
        });

        form.render();

        // 全选/取消全选
        $('#checkAll').on('change', function() {
            $('.category-checkbox').prop('checked', $(this).prop('checked'));
        });

        // 添加分类按钮点击事件
        $('#addCategoryBtn').on('click', function() {
            $('#modalTitle').text('添加分类');
            $('#categoryForm')[0].reset();
            $('#categoryId').val('');
            form.render();

            var modal = new bootstrap.Modal(document.getElementById('categoryModal'));
            modal.show();
        });

        // 编辑按钮点击事件
        $('.edit-btn').on('click', function() {
            var categoryId = $(this).data('id');
            var row = $(this).closest('tr');

            // 模拟从服务器获取数据
            $('#modalTitle').text('编辑分类');
            $('#categoryId').val(categoryId);
            $('#categoryName').val(row.find('td:eq(2)').text());

            // 设置图标
            var iconClass = row.find('.category-icon').attr('class');
            $('#categoryIcon').val(iconClass);

            // 设置排序值
            $('#sortOrder').val(row.find('td:eq(4)').text());

            // 设置状态
            var status = row.find('td:eq(6)').text().trim() === '启用' ? true : false;
            $('#status').prop('checked', status);

            form.render();

            var modal = new bootstrap.Modal(document.getElementById('categoryModal'));
            modal.show();
        });

        // 保存分类
        $('#saveCategoryBtn').on('click', function() {
            // 表单验证
            if ($('#categoryName').val().trim() === '') {
                layer.msg('请输入分类名称', {icon: 2});
                return;
            }

            if ($('#categoryIcon').val() === '') {
                layer.msg('请选择分类图标', {icon: 2});
                return;
            }

            if ($('#sortOrder').val().trim() === '') {
                layer.msg('请输入排序值', {icon: 2});
                return;
            }

            // 模拟保存操作
            layer.msg('保存成功', {icon: 1});

            // 关闭模态框
            var modal = bootstrap.Modal.getInstance(document.getElementById('categoryModal'));
            modal.hide();

            // 在实际应用中，这里应该发送AJAX请求到服务器
        });

        // 删除按钮点击事件
        $('.delete-btn').on('click', function() {
            var categoryId = $(this).data('id');
            var categoryName = $(this).closest('tr').find('td:eq(2)').text();

            layer.confirm('确定要删除分类 "' + categoryName + '" 吗？', {
                icon: 3,
                title: '删除确认'
            }, function(index) {
                // 模拟删除操作
                layer.msg('删除成功', {icon: 1});
                layer.close(index);

                // 在实际应用中，这里应该发送AJAX请求到服务器
            });
        });

        // 批量删除
        $('#batchDeleteBtn').on('click', function() {
            var checkedBoxes = $('.category-checkbox:checked');
            if (checkedBoxes.length === 0) {
                layer.msg('请选择要删除的分类', {icon: 2});
                return;
            }

            layer.confirm('确定要删除选中的 ' + checkedBoxes.length + ' 个分类吗？', {
                icon: 3,
                title: '批量删除确认'
            }, function(index) {
                // 模拟删除操作
                layer.msg('删除成功', {icon: 1});
                layer.close(index);

                // 在实际应用中，这里应该发送AJAX请求到服务器
            });
        });

        // 搜索按钮点击事件
        $('#searchBtn').on('click', function() {
            var name = $('#searchName').val();
            var status = $('#searchStatus').val();

            // 模拟搜索操作
            layer.msg('搜索完成', {icon: 1});

            // 在实际应用中，这里应该发送AJAX请求到服务器并更新表格
        });

        // 刷新按钮点击事件
        $('#refreshBtn').on('click', function() {
            // 模拟刷新操作
            layer.msg('数据已刷新', {icon: 1});

            // 在实际应用中，这里应该重新加载表格数据
        });
    });
</script>
